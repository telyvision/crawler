<?php

$db = '{
  "result": [
    {
      "id": "/en/twin_peaks",
      "type": "/tv/tv_program",
      "name": "Twin Peaks",
      "mid": "/m/07gbf"
    },
    {
      "id": "/en/gilligans_island",
      "type": "/tv/tv_program",
      "name": "Gilligan\'s Island",
      "mid": "/m/0m0sm"
    },
    {
      "id": "/en/the_sopranos",
      "type": "/tv/tv_program",
      "name": "The Sopranos",
      "mid": "/m/0kfv9"
    },
    {
      "id": "/en/the_shield",
      "type": "/tv/tv_program",
      "name": "The Shield",
      "mid": "/m/01xr2s"
    },
    {
      "id": "/en/seinfeld",
      "type": "/tv/tv_program",
      "name": "Seinfeld",
      "mid": "/m/072kp"
    },
    {
      "id": "/en/all_in_the_family",
      "type": "/tv/tv_program",
      "name": "All in the Family",
      "mid": "/m/015pnb"
    },
    {
      "id": "/en/six_feet_under",
      "type": "/tv/tv_program",
      "name": "Six Feet Under",
      "mid": "/m/01g03q"
    },
    {
      "id": "/en/first_of_the_summer_wine",
      "type": "/tv/tv_program",
      "name": "First of the Summer Wine",
      "mid": "/m/06wqbn"
    },
    {
      "id": "/en/survival_of_the_richest",
      "type": "/tv/tv_program",
      "name": "Survival of the Richest",
      "mid": "/m/0cchpm"
    },
    {
      "id": "/en/that_girl",
      "type": "/tv/tv_program",
      "name": "That Girl",
      "mid": "/m/03gwmv"
    },
    {
      "id": "/en/ed",
      "type": "/tv/tv_program",
      "name": "Ed",
      "mid": "/m/020yvv"
    },
    {
      "id": "/en/disneys_adventures_of_the_gummi_bears",
      "type": "/tv/tv_program",
      "name": "Disney\'s Adventures of the Gummi Bears",
      "mid": "/m/01vglz"
    },
    {
      "id": "/en/most_evil",
      "type": "/tv/tv_program",
      "name": "Most Evil",
      "mid": "/m/0ghhtt"
    },
    {
      "id": "/en/this_week_at_war",
      "type": "/tv/tv_program",
      "name": "This Week in Politics",
      "mid": "/m/0gbq7s"
    },
    {
      "id": "/en/meerkat_manor",
      "type": "/tv/tv_program",
      "name": "Meerkat Manor",
      "mid": "/m/0c28y1"
    },
    {
      "id": "/en/chico_and_the_man",
      "type": "/tv/tv_program",
      "name": "Chico and the Man",
      "mid": "/m/0hw69"
    },
    {
      "id": "/en/harsh_realm",
      "type": "/tv/tv_program",
      "name": "Harsh Realm",
      "mid": "/m/03xvn6"
    },
    {
      "id": "/en/baywatch_nights",
      "type": "/tv/tv_program",
      "name": "Baywatch Nights",
      "mid": "/m/04g7yp"
    },
    {
      "id": "/en/227",
      "type": "/tv/tv_program",
      "name": "227",
      "mid": "/m/02nxj7"
    },
    {
      "id": "/en/garo",
      "type": "/tv/tv_program",
      "name": "Garo",
      "mid": "/m/0bl_xj"
    },
    {
      "id": "/en/astronauts",
      "type": "/tv/tv_program",
      "name": "Astronauts",
      "mid": "/m/06k8xx"
    },
    {
      "id": "/en/shoestring",
      "type": "/tv/tv_program",
      "name": "Shoestring",
      "mid": "/m/05kxcp"
    },
    {
      "id": "/en/dick_clarks_new_years_rockin_eve",
      "type": "/tv/tv_program",
      "name": "Dick Clark\'s New Year\'s Rockin\' Eve",
      "mid": "/m/06gfbw"
    },
    {
      "id": "/en/dream_team",
      "type": "/tv/tv_program",
      "name": "Dream Team",
      "mid": "/m/03ty89"
    },
    {
      "id": "/en/everwood",
      "type": "/tv/tv_program",
      "name": "Everwood",
      "mid": "/m/02myrj"
    },
    {
      "id": "/wikipedia/fr/Star_ou_Boucher",
      "type": "/tv/tv_program",
      "name": "Sons of Butcher",
      "mid": "/m/0k_x8z"
    },
    {
      "id": "/en/mystery_science_theater_3000",
      "type": "/tv/tv_program",
      "name": "Mystery Science Theater 3000",
      "mid": "/m/057lh"
    },
    {
      "id": "/en/beg_borrow_deal",
      "type": "/tv/tv_program",
      "name": "Beg, Borrow & Deal",
      "mid": "/m/0gt5lq"
    },
    {
      "id": "/en/so_weird",
      "type": "/tv/tv_program",
      "name": "So Weird",
      "mid": "/m/05zswr"
    },
    {
      "id": "/en/the_wrong_coast",
      "type": "/tv/tv_program",
      "name": "The Wrong Coast",
      "mid": "/m/07s05f"
    },
    {
      "id": "/en/vr_5",
      "type": "/tv/tv_program",
      "name": "VR.5",
      "mid": "/m/04t5qf"
    },
    {
      "id": "/en/idol_ko_si_kap",
      "type": "/tv/tv_program",
      "name": "Idol Ko si Kap",
      "mid": "/m/07_z31"
    },
    {
      "id": "/en/food_jammers",
      "type": "/tv/tv_program",
      "name": "Food Jammers",
      "mid": "/m/0fd003"
    },
    {
      "id": "/en/erky_perky",
      "type": "/tv/tv_program",
      "name": "Erky Perky",
      "mid": "/m/0f7rb6"
    },
    {
      "id": "/en/the_jeffersons",
      "type": "/tv/tv_program",
      "name": "The Jeffersons",
      "mid": "/m/02f8jf"
    },
    {
      "id": "/en/lonelygirl15",
      "type": "/tv/tv_program",
      "name": "Lonelygirl15",
      "mid": "/m/0g88_d"
    },
    {
      "id": "/en/canadas_next_top_model",
      "type": "/tv/tv_program",
      "name": "Canada\'s Next Top Model",
      "mid": "/m/0b7xwr"
    },
    {
      "id": "/wikipedia/en_title/Girls_on_Top_$0028TV_series$0029",
      "type": "/tv/tv_program",
      "name": "Girls on Top",
      "mid": "/m/07ffv3"
    },
    {
      "id": "/en/hogan_knows_best",
      "type": "/tv/tv_program",
      "name": "Hogan Knows Best",
      "mid": "/m/06w5y8"
    },
    {
      "id": "/wikipedia/en_title/Sunrise_$0028TV_program$0029",
      "type": "/tv/tv_program",
      "name": "Sunrise",
      "mid": "/m/046cfy"
    },
    {
      "id": "/en/battlestar_galactica_2003",
      "type": "/tv/tv_program",
      "name": "Battlestar Galactica",
      "mid": "/m/02gl58"
    },
    {
      "id": "/en/24",
      "type": "/tv/tv_program",
      "name": "24",
      "mid": "/m/0hz55"
    },
    {
      "id": "/en/keyshia_cole_the_way_it_is",
      "type": "/tv/tv_program",
      "name": "Keyshia Cole: The Way It Is",
      "mid": "/m/0fv7bc"
    },
    {
      "id": "/en/keynotes",
      "type": "/tv/tv_program",
      "name": "Keynotes",
      "mid": "/m/081h0q"
    },
    {
      "id": "/en/charmed",
      "type": "/tv/tv_program",
      "name": "Charmed",
      "mid": "/m/01f3p_"
    },
    {
      "id": "/en/the_flintstones",
      "type": "/tv/tv_program",
      "name": "The Flintstones",
      "mid": "/m/0dn0r"
    },
    {
      "id": "/en/the_comeback",
      "type": "/tv/tv_program",
      "name": "The Comeback",
      "mid": "/m/05pnbf"
    },
    {
      "id": "/wikipedia/pt/Ratz",
      "type": "/tv/tv_program",
      "name": "Ratz",
      "mid": "/m/07mz5h"
    },
    {
      "id": "/m/0dkkwv",
      "type": "/tv/tv_program",
      "name": "Cooperation",
      "mid": "/m/0dkkwv"
    },
    {
      "id": "/en/gamezville",
      "type": "/tv/tv_program",
      "name": "Gamezville",
      "mid": "/m/09gttg"
    },
    {
      "id": "/en/sports_night",
      "type": "/tv/tv_program",
      "name": "Sports Night",
      "mid": "/m/01j46y"
    },
    {
      "id": "/en/the_new_adventures_of_winnie_the_pooh",
      "type": "/tv/tv_program",
      "name": "The New Adventures of Winnie the Pooh",
      "mid": "/m/01hl3r"
    },
    {
      "id": "/en/flamingo_road",
      "type": "/tv/tv_program",
      "name": "Flamingo Road",
      "mid": "/m/02x6r9"
    },
    {
      "id": "/en/cd_uk",
      "type": "/tv/tv_program",
      "name": "CD:UK",
      "mid": "/m/05h7ms"
    },
    {
      "id": "/en/office_gossip",
      "type": "/tv/tv_program",
      "name": "Office Gossip",
      "mid": "/m/0fm19t"
    },
    {
      "id": "/en/rocket_power",
      "type": "/tv/tv_program",
      "name": "Rocket Power",
      "mid": "/m/01jn4p"
    },
    {
      "id": "/en/yakkity_yak",
      "type": "/tv/tv_program",
      "name": "Yakkity Yak",
      "mid": "/m/042mzg"
    },
    {
      "id": "/en/doggy_fizzle_televizzle",
      "type": "/tv/tv_program",
      "name": "Doggy Fizzle Televizzle",
      "mid": "/m/04v5y9"
    },
    {
      "id": "/wikipedia/en_title/Greed_$0028game_show$0029",
      "type": "/tv/tv_program",
      "name": "Greed",
      "mid": "/m/025wlx"
    },
    {
      "id": "/wikipedia/en_title/Pay_and_Display_$0028TV_series$0029",
      "type": "/tv/tv_program",
      "name": "Pay and Display",
      "mid": "/m/0gcwzb"
    },
    {
      "id": "/en/saved_by_the_bell_the_college_years",
      "type": "/tv/tv_program",
      "name": "Saved by the Bell: The College Years",
      "mid": "/m/0b_kq_"
    },
    {
      "id": "/en/empire_square",
      "type": "/tv/tv_program",
      "name": "Empire Square",
      "mid": "/m/0d1v6y"
    },
    {
      "id": "/en/mamas_family",
      "type": "/tv/tv_program",
      "name": "Mama\'s Family",
      "mid": "/m/02ww98"
    },
    {
      "id": "/en/up_pompeii",
      "type": "/tv/tv_program",
      "name": "Up Pompeii!",
      "mid": "/m/0jgbx"
    },
    {
      "id": "/en/the_batman",
      "type": "/tv/tv_program",
      "name": "The Batman",
      "mid": "/m/04lgwh"
    },
    {
      "id": "/en/the_peoples_court",
      "type": "/tv/tv_program",
      "name": "The People\'s Court",
      "mid": "/m/03jrsq"
    },
    {
      "id": "/en/beverly_hills_90210",
      "type": "/tv/tv_program",
      "name": "Beverly Hills, 90210",
      "mid": "/m/0n2bh"
    },
    {
      "id": "/en/dexter",
      "type": "/tv/tv_program",
      "name": "Dexter",
      "mid": "/m/0fhzwl"
    },
    {
      "id": "/en/the_single_guy",
      "type": "/tv/tv_program",
      "name": "The Single Guy",
      "mid": "/m/0bcppn"
    },
    {
      "id": "/wikipedia/en_title/Heist_$0028TV_series$0029",
      "type": "/tv/tv_program",
      "name": "Heist",
      "mid": "/m/0b55ws"
    },
    {
      "id": "/en/mcleods_daughters",
      "type": "/tv/tv_program",
      "name": "McLeod\'s Daughters",
      "mid": "/m/02yspl"
    },
    {
      "id": "/en/darcys_wild_life",
      "type": "/tv/tv_program",
      "name": "Darcy\'s Wild Life",
      "mid": "/m/0710qt"
    },
    {
      "id": "/en/madan_senki_ryukendo",
      "type": "/tv/tv_program",
      "name": "Madan Senki Ryukendo",
      "mid": "/m/0cwhld"
    },
    {
      "id": "/en/birds_of_a_feather",
      "type": "/tv/tv_program",
      "name": "Birds of a Feather",
      "mid": "/m/031b1q"
    },
    {
      "id": "/en/alias",
      "type": "/tv/tv_program",
      "name": "Alias",
      "mid": "/m/01rf57"
    },
    {
      "id": "/en/the_price_is_right_million_dollar_spectacular",
      "type": "/tv/tv_program",
      "name": "The Price Is Right",
      "mid": "/m/097h2"
    },
    {
      "id": "/en/go_go_stop",
      "type": "/tv/tv_program",
      "name": "Go Go Stop",
      "mid": "/m/08hqtl"
    },
    {
      "id": "/en/love_to_love",
      "type": "/tv/tv_program",
      "name": "Love to Love",
      "mid": "/m/07_z53"
    },
    {
      "id": "/en/the_showbiz_show_with_david_spade",
      "type": "/tv/tv_program",
      "name": "The Showbiz Show with David Spade",
      "mid": "/m/08f5_0"
    },
    {
      "id": "/en/double_the_fist",
      "type": "/tv/tv_program",
      "name": "Double the Fist",
      "mid": "/m/04nd_x"
    },
    {
      "id": "/en/mission_hill",
      "type": "/tv/tv_program",
      "name": "Mission Hill",
      "mid": "/m/02t_kr"
    },
    {
      "id": "/en/haversham_hall",
      "type": "/tv/tv_program",
      "name": "Haversham Hall",
      "mid": "/m/0bnk4s"
    },
    {
      "id": "/en/austin_stories",
      "type": "/tv/tv_program",
      "name": "Austin Stories",
      "mid": "/m/02kzq0"
    },
    {
      "id": "/en/silver_spoons",
      "type": "/tv/tv_program",
      "name": "Silver Spoons",
      "mid": "/m/03hzwy"
    },
    {
      "id": "/wikipedia/en_title/Q$002E$002E$002E_$0028TV_series$0029",
      "type": "/tv/tv_program",
      "name": "Q...",
      "mid": "/m/05cm0c"
    },
    {
      "id": "/en/skunked_tv",
      "type": "/tv/tv_program",
      "name": "Skunked TV",
      "mid": "/m/0g76fg"
    },
    {
      "id": "/en/love_spell",
      "type": "/tv/tv_program",
      "name": "Love Spell",
      "mid": "/m/0fshx3"
    },
    {
      "id": "/en/jack_horkheimer_star_gazer",
      "type": "/tv/tv_program",
      "name": "Star Gazers",
      "mid": "/m/0cry93"
    },
    {
      "id": "/en/south_of_nowhere",
      "type": "/tv/tv_program",
      "name": "South of Nowhere",
      "mid": "/m/086wcx"
    },
    {
      "id": "/en/chucklevision",
      "type": "/tv/tv_program",
      "name": "ChuckleVision",
      "mid": "/m/03b6l5"
    },
    {
      "id": "/wikipedia/en_title/Your_Song_$0028TV_series$0029",
      "type": "/tv/tv_program",
      "name": "Your Song",
      "mid": "/m/0dk0lq"
    },
    {
      "id": "/en/miss_match",
      "type": "/tv/tv_program",
      "name": "Miss Match",
      "mid": "/m/03dblg"
    },
    {
      "id": "/en/courage_the_cowardly_dog",
      "type": "/tv/tv_program",
      "name": "Courage the Cowardly Dog",
      "mid": "/m/01t49s"
    },
    {
      "id": "/en/the_new_andy_griffith_show",
      "type": "/tv/tv_program",
      "name": "The New Andy Griffith Show",
      "mid": "/m/0h00xv"
    },
    {
      "id": "/en/the_hilarious_house_of_frightenstein",
      "type": "/tv/tv_program",
      "name": "The Hilarious House of Frightenstein",
      "mid": "/m/03jb0g"
    },
    {
      "id": "/en/three_up_two_down",
      "type": "/tv/tv_program",
      "name": "Three Up, Two Down",
      "mid": "/m/0c83yq"
    },
    {
      "id": "/en/dick_and_dom_in_da_bungalow",
      "type": "/tv/tv_program",
      "name": "Dick and Dom in da Bungalow",
      "mid": "/m/02qlpl"
    },
    {
      "id": "/en/ikaw_ang_lahat_sa_akin",
      "type": "/tv/tv_program",
      "name": "Ikaw ang Lahat sa Akin",
      "mid": "/m/07c91d"
    },
    {
      "id": "/en/royal_canadian_air_farce",
      "type": "/tv/tv_program",
      "name": "Air Farce Live",
      "mid": "/m/0168nb"
    },
    {
      "id": "/en/fox_news_sunday",
      "type": "/tv/tv_program",
      "name": "Fox News Sunday",
      "mid": "/m/0721mp"
    }
  ]
}';

$db_json = json_decode($db);

$tv_array['document'] = array();
$i = 0;
foreach($db_json->result as $mydata)
{
	//if ($i>3) continue;
	$i++;
	echo "Parsing data for: $i - ".$mydata->mid . "\n";
	$description_url = "https://www.googleapis.com/freebase/v1/topic{$mydata->mid}?filter=/common/topic/description";
	// echo $description_url."\n";
	 
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_URL,$description_url);
	$result=curl_exec($ch);
	curl_close($ch);
	 
	$description_json = json_decode($result, true);
	 
	$description = $description_json['property']['/common/topic/description']['values'][0]['value'];

	//$mydata->description = $description;

	$tv_data = array();
	//$tv_data['id'] = $mydata->id;
	//  $tv_data['type'] = $mydata->type;
	$tv_data['title'] = $mydata->name;
	//  $tv_data['reference'] = str_replace("/", "", $mydata->mid);
	$tv_data['reference'] = str_replace("/", "", $mydata->id);
	$tv_data['content'] = preg_replace('/[^a-z0-9 ]/i', '_', $description);

	array_push($tv_array['document'], $tv_data);
}

//print_r ($tv_array); exit;

$text= json_encode($tv_array);
echo "saving Data...\n";

$myfile = fopen("data.json", "w") or die("Unable to open file!");
fwrite($myfile, $text);
fclose($myfile);

echo "saved!\n";
/*
 {
 "document" :
 [
 {
 "title" : "This is my document",
 "reference" : "mydoc1",
 "myfield" : ["a value"],
 "content" : "A large block of text, which makes up the main body of the document."
 }, {
 "title" : "My Other document",
 "reference" : "mydoc2",
 "content" : "This document is about something else"
 }
 ]
 }*/

?>